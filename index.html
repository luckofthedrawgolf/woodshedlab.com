<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Woodshed Lab — Professional Music Coaching</title>
  <meta name="description" content="Private music lessons from working pros. Upload a clip or book live coaching.">
  <link rel="preload" as="image" href="/assets/hero-poster.webp" />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="icon" href="/favicon.ico" />
</head>
<body>
  <!-- Sticky Header -->
  <header class="site-header" data-header>
    <div class="container nav">
      <a class="brand" href="/">WOODSHED&nbsp;LAB</a>
      <nav class="links">
        <a href="#how">How It Works</a>
        <a href="/instructors.html">Instructors</a>
        <a href="#pricing">Pricing</a>
        <a href="#faq">FAQ</a>
        <a class="btn" href="/apply.html">Apply</a>
        <a href="#" id="auth-btn" class="btn small">Sign in</a>
        <span id="user-chip" class="hidden" style="margin-left:.5rem;opacity:.8;"></span>
    </nav>
      <button class="hamburger" aria-label="Open Menu" data-menu-btn>
        <span></span><span></span><span></span>
      </button>
    </div>
    <div class="mobile-drawer" data-drawer>
      <a href="#how">How It Works</a>
      <a href="/instructors.html">Instructors</a>
      <a href="#pricing">Pricing</a>
      <a href="#faq">FAQ</a>
      <a class="btn" href="/apply.html">Apply</a>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <!-- Video background (safe if missing: we show poster/gradient) -->
    <video class="hero-video" autoplay muted playsinline loop preload="none" poster="/assets/hero-poster.webp" aria-hidden="true" data-hero-video>
      <source src="/assets/hero.mp4" type="video/mp4" />
    </video>
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h1 class="headline">Private Music Lessons from Working Pros</h1>
      <p class="subhead">Upload a clip or book live coaching. Start with drums today — add more instruments as we grow.</p>
      <div class="cta-row">
        <a class="btn primary" href="/instructors.html">Find an Instructor</a>
        <a class="btn ghost" href="/apply.html">Apply as Instructor</a>
        <!-- Upload button -->
<div class="hero-upload" style="text-align:center; margin-top:20px;">
  <a href="/upload.html" class="btn btn-upload">Upload a Video</a>
</div>
      </div>
    </div>
  </section>

  <!-- Placeholder anchors for future sections -->
  <main>
    <section id="how" class="section">
      <div class="container">
        <h2>How It Works</h2>
        <ol class="steps">
          <li><strong>Pick an Instructor</strong> — browse verified pros.</li>
          <li><strong>Upload or Schedule</strong> — send a clip or book live.</li>
          <li><strong>Get Feedback</strong> — personalized video notes or real-time coaching.</li>
        </ol>
      </div>
    </section>

    <section id="pricing" class="section">
      <div class="container">
        <h2>Pricing</h2>
        <p>Sample tiers like Skillest (we’ll refine later): 30-min, 60-min, Monthly.</p>
      </div>
    </section>

    <section id="faq" class="section">
      <div class="container">
        <h2>FAQ</h2>
        <p>We’ll add real Q&A next step.</p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-grid">
      <div>
        <div class="brand brand-footer">WOODSHED LAB</div>
        <p class="tagline">Professional music coaching — anytime, anywhere.</p>
      </div>
      <div>
        <h4>Explore</h4>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="#how">How It Works</a></li>
          <li><a href="/instructors.html">Instructors</a></li>
          <li><a href="#pricing">Pricing</a></li>
          <li><a href="#faq">FAQ</a></li>
        </ul>
      </div>
      <div>
        <h4>Company</h4>
        <ul>
          <li><a href="/contact.html">Contact</a></li>
          <li><a href="/legal/privacy.html">Privacy</a></li>
          <li><a href="/legal/terms.html">Terms</a></li>
        </ul>
      </div>
    </div>
    <div class="container footnote">© <span id="year"></span> Woodshed Lab. All rights reserved.</div>
  </footer>

  <script src="/app.js"></script>
   <!-- Auth Modal -->
<div id="auth-modal" class="modal hidden" aria-hidden="true" role="dialog">
  <div class="modal-dialog">
    <button class="modal-close" id="auth-close" aria-label="Close">&times;</button>
    <h3 id="auth-title">Sign in</h3>

    <form id="auth-form">
      <label>
        <span>Email</span>
        <input id="auth-email" type="email" autocomplete="email" required />
      </label>

      <label id="name-field" style="display:none;">
        <span>Full name (for new accounts)</span>
        <input id="auth-name" type="text" autocomplete="name" />
      </label>

      <label>
        <span>Password</span>
        <input id="auth-password" type="password" autocomplete="current-password" required />
      </label>

      <button type="submit" class="btn" id="auth-submit">Continue</button>
      <div class="auth-message" id="auth-message"></div>
    </form>

    <p class="auth-switch">
      <span id="auth-switch-text">Don’t have an account?</span>
      <a href="#" id="auth-switch-link">Create one</a>
    </p>
  </div>
</div>
  <script>
  console.log("JS loaded ✅");
</script>
  <script type="module">
  import { supabase } from './supabase.js';

  // Elements
  const authBtn = document.querySelector('#auth-btn');     // the "Sign in" button in your header
  const modal    = document.querySelector('#auth-modal');
  const closeBtn = document.querySelector('#auth-close');
  const form     = document.querySelector('#auth-form');
  const emailEl  = document.querySelector('#auth-email');
  const passEl   = document.querySelector('#auth-password');
  const nameRow  = document.querySelector('#name-field');
  const nameEl   = document.querySelector('#auth-name');
  const msgEl    = document.querySelector('#auth-message');
  const titleEl  = document.querySelector('#auth-title');
  const submitEl = document.querySelector('#auth-submit');
  const switchText = document.querySelector('#auth-switch-text');
  const switchLink = document.querySelector('#auth-switch-link');

  let mode = 'signin'; // 'signin' or 'signup'

  function ui(state) {
    if (state === 'open') {
      modal.classList.remove('hidden');
      modal.setAttribute('aria-hidden', 'false');
    } else if (state === 'close') {
      modal.classList.add('hidden');
      modal.setAttribute('aria-hidden', 'true');
      form.reset();
      msg('');
    }
  }

  function msg(text, isError = false) {
    msgEl.textContent = text || '';
    msgEl.style.color = isError ? '#ff9ea1' : '#cde8bd';
  }

  function setMode(next) {
    mode = next;
    const isSignUp = mode === 'signup';
    titleEl.textContent = isSignUp ? 'Create account' : 'Sign in';
    submitEl.textContent = isSignUp ? 'Create account' : 'Sign in';
    nameRow.style.display = isSignUp ? '' : 'none';
    switchText.textContent = isSignUp ? 'Already have an account?' : 'Don’t have an account?';
    switchLink.textContent = isSignUp ? 'Sign in' : 'Create one';
  }

  // Open/close modal
  authBtn?.addEventListener('click', (e) => {
    e.preventDefault();
    setMode('signin');
    ui('open');
  });

  closeBtn.addEventListener('click', () => ui('close'));
  modal.addEventListener('click', (e) => {
    if (e.target === modal) ui('close');
  });

  // Toggle sign in / sign up
  switchLink.addEventListener('click', (e) => {
    e.preventDefault();
    setMode(mode === 'signin' ? 'signup' : 'signin');
  });

  // Submit
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg('');

    const email = emailEl.value.trim();
    const password = passEl.value;
    const fullName = nameEl.value.trim();

    try {
      if (mode === 'signup') {
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: { data: { full_name: fullName || null } }
        });
        if (error) throw error;

        // Ensure a profile row exists
        if (data.user) {
          await supabase
            .from('profiles')
            .insert([{ id: data.user.id, full_name: fullName || null, role: 'student' }], { upsert: true });
        }
        msg('Account created. You are signed in.');
        ui('close');

      } else {
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        msg('Signed in!');
        ui('close');
      }
    } catch (err) {
      msg(err.message || 'Something went wrong', true);
    }
  });

  // Keep header button in sync with auth state
  function setHeaderAuth(isLoggedIn) {
    if (!authBtn) return;
    if (isLoggedIn) {
      authBtn.textContent = 'Sign out';
      authBtn.classList.add('danger');
      authBtn.onclick = async (e) => {
        e.preventDefault();
        await supabase.auth.signOut();
      };
    } else {
      authBtn.textContent = 'Sign in';
      authBtn.classList.remove('danger');
      authBtn.onclick = (e) => {
        e.preventDefault();
        setMode('signin');
        ui('open');
      };
    }
  }

  // Initial state + realtime updates
  const { data: { session } } = await supabase.auth.getSession();
  setHeaderAuth(!!session);

  supabase.auth.onAuthStateChange((_event, sess) => {
    setHeaderAuth(!!sess);
  });
</script>
</body>
</html>
